<launch>
  <param name="use_sim_time" value="true" />

  <!-- User supplied arguments -->
  <arg name="pointcloud_topic" default="/camera/depth_registered/sw_registered/points" doc="ROS topic for pointcloud input" />
  <arg name="show_rviz" default="false" doc="Automatically launch Rviz." />
  <arg name="scene_name" default="cvg_lab" />
  <arg name="sensor_name" default="xtion" />
  <arg name="visualize" default="false" />
  <arg name="verbose" default="true"/>

  <node pkg="tf" type="static_transform_publisher" name="map0_to_mission0" args="0 0 0 0 0 0 1 map_0 mission_0 100"/>
  <!--tf borrowed from realsense-->
  <!-- <node pkg="tf" type="static_transform_publisher" name="base_to_kinect2_0" args="0 0 0 0.502 -0.499 0.503 -0.496 robot_base_0 kinect2_rgb_optical_frame_0 100"/> -->

  <node pkg="nodelet" type="nodelet" name="nodelet_manager0" args="manager" output="screen"/>
  <node pkg="nodelet" type="nodelet" name="cloudify0" args="load depth_image_proc/point_cloud_xyzrgb nodelet_manager0 --no-bond">
    <remap from="depth_registered/image_rect" to="/camera/depth_registered/sw_registered/image_rect"/>
    <remap from="depth_registered/points" to="$(arg pointcloud_topic)"/>
    <remap from="rgb/image_rect_color" to="/camera/rgb/image_rect_color"/>
    <remap from="rgb/camera_info" to="/camera/rgb/camera_info"/>
  </node>

  <arg name="debug" default="false" />

  <group>
    <arg unless="$(arg debug)" name="launch_prefix" value=" " />
    <arg if="$(arg debug)" name="launch_prefix" value="xterm -e gdb --args" />

    <node name="label_tsdf_client_0" pkg="maskgraph" type="label_tsdf_server" output="screen" args="-alsologtostderr" clear_params="true" launch-prefix="$(arg launch_prefix)">
      <remap from="pointcloud" to="$(arg pointcloud_topic)"/>
      <rosparam file="$(find maskgraph)/config/label_tsdf_server.yaml"/>
      <rosparam file="$(find maskgraph)/config/segment_map.yaml"/>
      <rosparam file="$(find maskgraph)/config/$(arg scene_name).yaml"/>
      <rosparam file="$(find coxgraph)/config/$(arg sensor_name).yaml"/>
      <param name="meshing/visualize" value="$(arg visualize)" />
      <param name="enable_segment_map" value="false" />
      <param name="enable_local_segment_map" value="false" />
      <param name="verbose" value="$(arg verbose)" />
      <param name="world_frame" value="map_0"/>
      <!-- <param name="point_cloud_frame_id" value="kinect2_rgb_optical_frame_0" /> -->
      <param name="point_cloud_frame_id" value="robot_base_0" />
    </node>

  </group>


</launch>
